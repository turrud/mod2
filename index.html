<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>modul3-PBO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  </head>
  <body>
    <div class="container mt-5">
      <div class="row">
        
        <div class="col-md-6 mb-3">
          <div class="form-floating">
            <textarea cols="auto" rows="auto" class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px">
                # import library socket karena menggunakan IPC socket
                import socket

                # definisikan IP server tujuan file akan diupload
                TCP_IP = '127.0.0.1'

                # definisikan port number proses di server
                TCP_PORT = 49343

                # definisikan ukuran buffer untuk mengirim
                BUFFER_SIZE = 1024

                # buat socket (apakah bertipe UDP atau TCP?)
                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

                # lakukan koneksi ke server
                s.connect((TCP_IP, TCP_PORT))

                # buka file bernama "file_diupload.txt bertipe byte
                filename='file_diupload.txt'
                f = open(filename,'rb')
                # masih hard code, file harus ada dalam folder yang sama dengan script python


                try:
                    byte = f.read(1024)
                    # baca file tersebut sebesar buffer 
                    
                    
                    # selama tidak END OF FILE; pada pyhton EOF adalah b''
                    while byte != b'':
                        # kirim hasil pembacaan file
                        s.send(byte)
                        
                        # baca sisa file hingga EOF
                        l = f.read(1024)
                        #print(byte)
                finally:
                    print ("end sending")
                    
                    # tutup file jika semua file telah  dibaca
                    f.close()

                # tutup koneksi setelah file terkirim
                s.close()
            </textarea>
            <label for="floatingTextarea2">01.upload_file_client.py</label>
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <div class="form-floating">
            <textarea cols="auto" rows="auto" class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px">
                # import library socket karena menggunakan IPC socket
                import socket

                # definisikan IP untuk binding
                TCP_IP = "127.0.0.1"

                # definisikan port untuk binding
                TCP_PORT = 49343

                # definisikan ukuran buffer untuk menerima pesan
                BUFFER_SIZE = 1024

                # buat socket (bertipe UDP atau TCP?)
                s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

                # lakukan binding ke IP dan port
                s.bind((TCP_IP,TCP_PORT))

                # lakukan listen
                s.listen(1)

                #  siap menerima koneksi
                conn, addr = s.accept()
                print ('Connection address:', addr)

                # buka/buat file bernama hasil_upload.txt untuk menyimpan hasil dari file yang dikirim server
                # masih hardcoded nama file, bertipe byte
                file =open('hasil_upload.txt',"wb")


                # loop forever
                while 1:
                    # terima pesan dari client
                    data = conn.recv(1024) 
                    
                    
                    # tulis pesan yang diterima dari client ke file kita (result.txt)
                    file.write(data)
                    
                    # berhenti jika sudah tidak ada pesan yang dikirim
                    if not data: break
                    
                # tutup file result.txt    
                file.close()

                #tutup socket
                socket.close()

                # tutup koneksi
                s.close()


            </textarea>
            <label for="floatingTextarea2">01.upload_file_server.py</label>
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <div class="form-floating">
            <textarea cols="auto" rows="auto" class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px">
                # import library socket karena menggunakan IPC socket
                import socket

                # definisikan IP server tujuan file akan diupload
                TCP_IP = "127.0.0.1"

                # definisikan port number proses di server
                TCP_PORT = 5005

                # definisikan ukuran buffer untuk mengirim
                BUFFER_SIZE = 1024

                # buat socket (apakah bertipe UDP atau TCP?)
                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

                # lakukan koneksi ke server
                s.connect((TCP_IP, TCP_PORT))

                # buka file bernama "hasil_download.txt bertipe byte
                f = open("./hasil_download.txt", "wb")
                # masih hard code, file harus ada dalam folder yang sama dengan script python


                # loop forever
                while 1:
                    # terima pesan dari server
                    data = s.recv(BUFFER_SIZE)
                    
                    # tulis pesan yang diterima dari server ke file telah dibuka sebelumnya (hasil_download.txt)
                    f.write(data)
                    
                    # berhenti jika sudah tidak ada pesan yang dikirim
                    if not data: break
                    
                # tutup hasil_download.txt    
                f.close()

                #tutup socket
                s.close()
            </textarea>
            <label for="floatingTextarea2">02.download_file_client.py</label>
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <div class="form-floating">
            <textarea cols="auto" rows="auto" class="form-control" placeholder="Leave a comment here" id="floatingTextarea2" style="height: 100px">
                # import library socket karena menggunakan IPC socket
                from os import close
                import socket

                # definisikan IP untuk binding
                TCP_IP = "127.0.0.1"

                # definisikan port untuk binding
                TCP_PORT = 5005

                # definisikan ukuran buffer untuk menerima pesan
                BUFFER_SIZE = 1024

                # buat socket (bertipe UDP atau TCP?)
                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

                # lakukan binding ke IP dan port
                s.bind((TCP_IP, TCP_PORT))

                # lakukan listen
                s.listen(1)

                #  siap menerima koneksi
                conn ,addr = s.accept()


                # buka file bernama "file_didownload.txt
                f = open("file_didownload.txt", '')
                # masih hard code, file harus ada dalam folder yang sama dengan script python


                try:
                    # baca file tersebut sebesar buffer 
                    byte = f.read(BUFFER_SIZE)
                    
                    # selama tidak END OF FILE; pada pyhton EOF adalah b''
                    while byte != b'':
                        # kirim hasil pembacaan file dari server ke client
                        conn.send(byte)
                        
                        # baca sisa file hingga EOF
                        byte = f.read(BUFFER_SIZE)
                        
                finally:
                    print ("end sending")
                    
                    # tutup file jika semua file telah  dibaca
                    s.close()

                # tutup socket
                s.close()

                # tutup koneksi
                conn.close()
            </textarea>
            <label for="floatingTextarea2">02.download_file_server.py</label>
          </div>
        </div>

      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  </body>
</html>


